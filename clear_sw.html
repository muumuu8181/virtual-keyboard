<!DOCTYPE html>
<html>
<head>
    <title>Clear Service Worker</title>
</head>
<body>
    <h1>Service Worker クリア中...</h1>
    <pre id="log"></pre>

    <script>
        const log = document.getElementById('log');

        async function clearAll() {
            log.textContent += 'Service Worker登録を確認中...\n';

            // Service Worker削除
            const registrations = await navigator.serviceWorker.getRegistrations();
            log.textContent += `見つかった登録: ${registrations.length}件\n`;

            for (let registration of registrations) {
                log.textContent += `削除中: ${registration.scope}\n`;
                await registration.unregister();
                log.textContent += '削除完了\n';
            }

            // キャッシュ削除
            log.textContent += '\nキャッシュを確認中...\n';
            const cacheNames = await caches.keys();
            log.textContent += `見つかったキャッシュ: ${cacheNames.length}件\n`;

            for (let name of cacheNames) {
                log.textContent += `削除中: ${name}\n`;
                await caches.delete(name);
                log.textContent += '削除完了\n';
            }

            log.textContent += '\n✅ 全て削除完了！\n';
            log.textContent += '\n3秒後にトップページにリダイレクトします...\n';

            setTimeout(() => {
                window.location.href = '/';
            }, 3000);
        }

        clearAll();
    </script>
</body>
</html>
